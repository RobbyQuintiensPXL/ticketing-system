version: '3.7'
services:
    config:
        image: config-service:0.0.1-SNAPSHOT
        restart: always
        ports:
            - "8888:8888"
        depends_on:
            - consul
    gateway:
        image: gateway-service:0.0.1-SNAPSHOT
        restart: always
        ports:
            - "9080:9080"
        depends_on:
            - consul
    database:
        image: mysql:latest
        environment:
            - MYSQL_ROOT_PASSWORD=mysqlpass
            - MYSQL_DATABASE=jevents_event_dev
        ports:
            - "3306:3306"
        volumes:
            - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    event-service:
        image: event-service:0.0.1-SNAPSHOT
        ports:
            - "8081:8081"
        environment:
            PROFILE: "dev"
            CONFIG_URI: "http://config:8888"
            CONFIG_PORT: "8888"
        depends_on:
            - config
            - database    
    consul:
        image: consul:latest
        ports:
            - "8500:8500"
        command: agent -server -ui -node=server1 -bootstrap-expect=1 -client=0.0.0.0